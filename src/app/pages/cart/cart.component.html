<div class="cart-container">
  <div class="cart-header">
    <h2>Shopping Cart</h2>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: #6d206e;"></i>
    <p>Loading your cart...</p>
  </div>

  <div class="cart-content" *ngIf="!isLoading && cartItems && cartItems.length > 0">
    <p-table [value]="cartItems" [tableStyle]="{'min-width': '100%'}" styleClass="cart-table">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 45%">PRODUCT</th>
          <th style="width: 20%; text-align: center">QTY</th>
          <th style="width: 20%; text-align: right">PRICE</th>
          <th style="width: 15%; text-align: center">ACTION</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
            <div class="product-info clickable" (click)="navigateToProduct(getProductId(item))">
              <img
                [src]="getProductImage(item)"
                [alt]="getProductName(item)"
                class="product-image"
                (error)="onImageError($event)" />
              <div class="product-details">
                <span class="product-name">{{ getProductName(item) }}</span>
                <div class="price-info">
                  <span class="unit-price">EGP {{ getProductPrice(item) | number: '1.2-2' }} each</span>
                  <span class="original-price" *ngIf="hasDiscount(item)">
                    <s>EGP {{ getProductOriginalPrice(item) | number: '1.2-2' }}</s>
                  </span>
                  <p-tag
                    *ngIf="hasDiscount(item)"
                    value="Sale"
                    severity="success"
                    styleClass="discount-tag">
                  </p-tag>
                </div>
              </div>
            </div>
          </td>


          <td style="text-align: center">
            <div class="quantity-controls">
              <p-button
                icon="pi pi-minus"
                [rounded]="true"
                [text]="true"
                severity="secondary"
                (onClick)="decrementQuantity(item)"
                [disabled]="getProductQuantity(item) <= 1">
              </p-button>

              <span class="quantity-value">{{ getProductQuantity(item) }}</span>

              <p-button
                icon="pi pi-plus"
                [rounded]="true"
                [text]="true"
                severity="secondary"
                (onClick)="incrementQuantity(item)">
              </p-button>
            </div>
          </td>

          <td style="text-align: right">
            <div class="item-total-price">
              <span class="product-price">EGP {{ getProductPrice(item) * getProductQuantity(item) | number: '1.2-2' }}</span>
              <span class="original-total" *ngIf="hasDiscount(item)">
                <s>EGP {{ getProductOriginalPrice(item) * getProductQuantity(item) | number: '1.2-2' }}</s>
              </span>
            </div>
          </td>

          <td style="text-align: center">
            <p-button
              label="Remove"
              severity="danger"
              [text]="true"
              (onClick)="removeItem(getProductId(item))">
            </p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <div class="cart-footer">
      <div class="cart-actions">
        <p-button
          label="Clear Cart"
          severity="secondary"
          [outlined]="true"
          icon="pi pi-trash"
          (onClick)="clearCart()">
        </p-button>
      </div>

      <div class="cart-summary">
        <div class="summary-row" *ngIf="calculateTotalSavings() > 0">
          <span class="summary-label">Original Total:</span>
          <span class="summary-value original">EGP {{ calculateOriginalTotal() | number: '1.2-2' }}</span>
        </div>
        <div class="summary-row savings" *ngIf="calculateTotalSavings() > 0">
          <span class="summary-label">Your Savings:</span>
          <span class="summary-value savings-value">-EGP {{ calculateTotalSavings() | number: '1.2-2' }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Subtotal:</span>
          <span class="summary-value">EGP {{ calculateSubtotal() | number: '1.2-2' }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Tax (10%):</span>
          <span class="summary-value">EGP {{ calculateSubtotal() * 0.1 | number: '1.2-2' }}</span>
        </div>
        <div class="summary-row total-row">
          <span class="summary-label">Total:</span>
          <span class="summary-value total-value">EGP {{ calculateSubtotal() * 1.1 | number: '1.2-2' }}</span>
        </div>
        <p-button
          label="Proceed to Checkout"
          icon="pi pi-arrow-right"
          iconPos="right"
          styleClass="checkout-button"
          (onClick)="proceedToCheckout()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Empty Cart State -->
  <div class="empty-cart" *ngIf="!isLoading && (!cartItems || cartItems.length === 0)">
    <i class="pi pi-shopping-cart empty-cart-icon"></i>
    <h3>Your cart is empty</h3>
    <p>Add items to your cart to see them here</p>
    <p-button
      label="Continue Shopping"
      icon="pi pi-arrow-left"
      [outlined]="true"
      routerLink="/user/home">
    </p-button>
  </div>
</div>

<p-toast position="top-right"></p-toast>
